---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import memoji from '../assets/memoji.png';
import { getCollection } from 'astro:content';
import ProjectCard from '../components/ProjectCard.astro';
import { formatDate } from '../utils';

// Get latest articles
const latestArticles = (await getCollection('articles'))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);

// Get latest notes
const latestNotes = (await getCollection('notes'))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);

// Get latest projects
const projectsImport = await import('../../public/projects.json');
const projects = projectsImport.default;
const latestProjects = projects
  .sort((a, b) => new Date(b.lastModified).getTime() - new Date(a.lastModified).getTime())
  .slice(0, 3);
---

<Layout>
  <!-- Hero Section -->
  <section class="py-12 md:py-16">
    <div class="flex items-center gap-6 mb-8">
      <h1 class="text-4xl md:text-5xl font-bold">
        Hi üëãüèª, I'm <a href="/about" class="underline decoration-zinc-400 hover:decoration-zinc-700 dark:decoration-zinc-300 dark:hover:decoration-white decoration-2 ">Erdal</a>!
      </h1>
    </div>
    <p class="text-xl md:text-2xl text-zinc-700 dark:text-zinc-300 max-w-2xl">
      I'm a software engineer passionate about AI, decentralization, privacy and open source.
      On this site, I share my thoughts, projects, and experiments.
    </p>
  </section>

  <!-- Latest Notes -->
  <section class="py-8">
    <h2 class="text-2xl md:text-3xl font-semibold mb-2">
      <a href="/notes" class="hover:underline decoration-zinc-400 hover:decoration-zinc-700 dark:decoration-zinc-300 dark:hover:decoration-white decoration-2">Notes</a>
    </h2>
    <ul class="mx-[-1rem]">
      {latestNotes.map(post => (
        <li>
          <a 
            href={`/notes/${post.slug}`}
            class="group flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 px-4 text-inherit no-underline hover:bg-orange-50 hover:dark:bg-zinc-800 rounded-lg"
          >
            <span class="text-zinc-900 dark:text-zinc-100 mb-2 sm:mb-0 sm:max-w-[75%]">{post.data.title}</span>
            <div class="flex flex-row items-center gap-3 text-zinc-600 dark:text-zinc-400">
              <time class="text-sm">
                {formatDate(post.data.pubDate)}
              </time>
            </div>
          </a>
        </li>
      ))}
    </ul>
  </section>

  <!-- Latest Articles -->
  <section class="py-8">
    <h2 class="text-2xl md:text-3xl font-semibold mb-2">
      <a href="/articles" class="hover:underline decoration-zinc-400 hover:decoration-zinc-700 dark:decoration-zinc-300 dark:hover:decoration-white decoration-2">Articles</a>
    </h2>
    <ul class="mx-[-1rem]">
      {latestArticles.map(post => (
        <li>
          <a 
            href={`/articles/${post.slug}`}
            class="group flex flex-col sm:flex-row sm:items-center sm:justify-between py-2 px-4 text-inherit no-underline hover:bg-orange-50 hover:dark:bg-zinc-800 rounded-lg"
          >
            <span class="text-zinc-900 dark:text-zinc-100 mb-2 sm:mb-0 sm:max-w-[75%]">{post.data.title}</span>
            <div class="flex flex-row items-center gap-3 text-zinc-600 dark:text-zinc-400">
              <time class="text-sm">
                {formatDate(post.data.pubDate)}
              </time>
            </div>
          </a>
        </li>
      ))}
    </ul>
  </section>

  <div class="border-t border-zinc-200 dark:border-zinc-700 my-1"></div>

  <!-- Featured Projects -->
  {latestProjects.length > 0 && (
    <section class="py-8">
      <h2 class="text-2xl md:text-3xl font-semibold mb-4">
        <a href="/projects" class="hover:underline decoration-zinc-400 hover:decoration-zinc-700 dark:decoration-zinc-300 dark:hover:decoration-white decoration-2">Projects</a>
      </h2>
      <div class="grid gap-6 md:grid-cols-3">
        {latestProjects.map(project => (
          <ProjectCard {...project} />
        ))}
      </div>
    </section>
  )}
</Layout>
